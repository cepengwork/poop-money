<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¤§è™Ÿè²¡ç¥çˆº ğŸ’©</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
:root{--bg:#1a1208;--surface:#2a1e0e;--card:#362912;--accent:#f5a623;--accent2:#e8732a;--text:#f5e6c8;--text-muted:#a89070;--green:#6bcb77;--border:#5a3e20;--hover:#4a3318;--red:#e05c5c}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'Noto Sans TC',sans-serif;min-height:100vh;padding:0 0 60px;background-image:radial-gradient(ellipse at 20% 0%,rgba(245,166,35,.08) 0%,transparent 50%),radial-gradient(ellipse at 80% 100%,rgba(232,115,42,.06) 0%,transparent 50%)}
.header{text-align:center;padding:40px 20px 30px;border-bottom:1px solid var(--border);position:relative;overflow:hidden}
.header::before{content:'ğŸ’©';font-size:200px;position:absolute;top:-40px;left:-40px;opacity:.04;pointer-events:none}
.header::after{content:'ğŸ’©';font-size:150px;position:absolute;bottom:-30px;right:-10px;opacity:.04;pointer-events:none}
.title{font-family:'Bebas Neue',sans-serif;font-size:clamp(36px,8vw,72px);letter-spacing:4px;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1;margin-bottom:8px}
.subtitle{color:var(--text-muted);font-size:14px;letter-spacing:2px;text-transform:uppercase}
.container{max-width:900px;margin:0 auto;padding:30px 20px;display:flex;flex-direction:column;gap:24px}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;position:relative}
.card-title{font-size:13px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--accent);margin-bottom:20px;display:flex;align-items:center;gap:8px}
.toggle-group{display:flex;background:var(--surface);border-radius:10px;padding:4px;gap:4px}
.toggle-btn{flex:1;padding:12px;border:none;border-radius:8px;background:transparent;color:var(--text-muted);font-family:'Noto Sans TC',sans-serif;font-size:15px;font-weight:700;cursor:pointer;transition:all .2s}
.toggle-btn.active{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#1a1208}
.input-group{display:flex;flex-direction:column;gap:8px;margin-top:16px}
.input-row{display:flex;gap:12px;flex-wrap:wrap}
.input-wrap{flex:1;min-width:180px}
label{display:block;font-size:12px;letter-spacing:1px;color:var(--text-muted);margin-bottom:6px;font-weight:700;text-transform:uppercase}
input[type="number"]{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:12px 14px;color:var(--text);font-family:'Noto Sans TC',sans-serif;font-size:16px;outline:none;transition:border-color .2s}
input[type="number"]:focus{border-color:var(--accent)}
input[type="number"]::placeholder{color:var(--text-muted)}
.input-hint{font-size:11px;color:var(--text-muted);margin-top:5px}
.input-hint a{color:var(--accent);cursor:pointer;text-decoration:underline}
.hourly-display{margin-top:12px;padding:12px 16px;background:var(--surface);border-radius:8px;border-left:3px solid var(--accent);font-size:14px;color:var(--text-muted);display:none}
.hourly-display span{color:var(--accent);font-weight:700;font-size:18px}
.salary-warning{display:none;margin-top:12px;padding:10px 14px;background:rgba(224,92,92,.12);border:1px solid rgba(224,92,92,.35);border-radius:8px;font-size:13px;color:var(--red);font-weight:700}
.month-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
.month-nav button{width:36px;height:36px;border-radius:50%;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s}
.month-nav button:hover{background:var(--hover);border-color:var(--accent)}
.month-label{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:3px;color:var(--text)}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}
.cal-header{text-align:center;font-size:11px;font-weight:700;letter-spacing:1px;color:var(--text-muted);padding:6px 0;text-transform:uppercase}
.cal-header.wh{color:var(--accent2)}
.cal-day{aspect-ratio:1;border-radius:8px;border:1px solid transparent;background:var(--surface);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .15s;position:relative;overflow:hidden;padding:2px}
.cal-day:hover{border-color:var(--accent);background:var(--hover)}
.cal-day.empty{background:transparent;cursor:default;border:none}
.cal-day.has-data{border-color:var(--accent2);background:rgba(245,166,35,.08)}
.cal-day.today{border-color:var(--green)}
.cal-day.we{background:rgba(232,115,42,.07)}
.cal-day.we:hover{background:rgba(232,115,42,.15)}
.cal-day-num{font-size:clamp(10px,2.2vw,14px);font-weight:700;line-height:1}
.cal-day-mins{font-size:clamp(8px,1.6vw,10px);color:var(--accent);font-weight:700;margin-top:2px;line-height:1;white-space:nowrap}
.cal-day-emoji{font-size:clamp(10px,2vw,14px);line-height:1}
.cal-day.we .cal-day-num{color:var(--accent2)}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:100;opacity:0;pointer-events:none;transition:opacity .2s}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:28px;width:320px;transform:scale(.9);transition:transform .2s}
.modal-overlay.open .modal{transform:scale(1)}
.modal-title{font-family:'Bebas Neue',sans-serif;font-size:26px;letter-spacing:2px;margin-bottom:6px}
.modal-date{color:var(--text-muted);font-size:13px;margin-bottom:20px}
.modal-input-wrap{position:relative}
.modal-input-wrap input{padding-right:50px}
.modal-unit{position:absolute;right:14px;top:50%;transform:translateY(-50%);color:var(--text-muted);font-size:13px;pointer-events:none}
.modal-enter-hint{font-size:11px;color:var(--text-muted);margin-top:6px;text-align:right}
.modal-btns{display:flex;gap:10px;margin-top:20px}
.btn{flex:1;padding:12px;border:none;border-radius:10px;font-family:'Noto Sans TC',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all .15s}
.btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#1a1208}
.btn-primary:hover{filter:brightness(1.1);transform:translateY(-1px)}
.btn-ghost{background:var(--surface);color:var(--text-muted);border:1px solid var(--border)}
.btn-ghost:hover{border-color:var(--accent);color:var(--text)}
.btn-danger{background:rgba(224,92,92,.15);color:var(--red);border:1px solid rgba(224,92,92,.3);flex:0 0 auto;padding:12px 14px}
.btn-danger:hover{background:rgba(224,92,92,.28)}
.summary-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.stat-box{background:var(--surface);border-radius:12px;padding:16px 12px;border:1px solid var(--border);text-align:center}
.stat-label{font-size:11px;letter-spacing:2px;text-transform:uppercase;color:var(--text-muted);font-weight:700;margin-bottom:10px}
.stat-value{font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;line-height:1;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.stat-sub{font-size:12px;color:var(--text-muted);margin-top:4px}
.productivity-bar{margin-top:20px}
.prod-label{display:flex;justify-content:space-between;font-size:12px;color:var(--text-muted);margin-bottom:8px;font-weight:700;letter-spacing:1px;text-transform:uppercase}
.bar-track{height:8px;background:var(--surface);border-radius:4px;overflow:hidden}
.bar-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0%;transition:width .6s ease}
.fun-message{margin-top:16px;padding:12px 16px;background:rgba(107,203,119,.1);border:1px solid rgba(107,203,119,.3);border-radius:8px;font-size:13px;color:var(--green);text-align:center;font-weight:700;letter-spacing:.5px}
.achievements-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
@media(min-width:600px){.achievements-grid{grid-template-columns:repeat(4,1fr)}}
.achievement{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px 10px;text-align:center;transition:all .3s;position:relative;overflow:hidden}
.achievement.unlocked{border-color:var(--accent);background:rgba(245,166,35,.08);box-shadow:0 0 16px rgba(245,166,35,.12)}
.achievement.locked{cursor:default}
.achievement-icon{font-size:26px;line-height:1;margin-bottom:6px;display:block}
.achievement.locked .achievement-icon{filter:brightness(0) opacity(0.45)}
.achievement-name{font-size:12px;font-weight:700;color:var(--text);margin-bottom:4px;line-height:1.3}
.achievement.unlocked .achievement-name{color:var(--accent)}
.achievement.locked .achievement-name{color:transparent;background:rgba(255,255,255,0.12);border-radius:4px;user-select:none}
.achievement-desc{font-size:10px;color:var(--text-muted);line-height:1.4}
.achievement.locked .achievement-desc{color:transparent;background:rgba(255,255,255,0.08);border-radius:3px;user-select:none}
.badge-new{position:absolute;top:6px;right:6px;background:var(--green);color:#1a1208;font-size:9px;font-weight:900;padding:2px 5px;border-radius:4px;letter-spacing:.5px;animation:popIn .4s ease}
@keyframes popIn{from{transform:scale(0)}to{transform:scale(1)}}
.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--accent);color:#1a1208;font-weight:700;font-size:14px;padding:12px 24px;border-radius:30px;z-index:999;opacity:0;transition:all .3s;white-space:nowrap;pointer-events:none}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.footer-note{text-align:center;color:var(--text-muted);font-size:12px;letter-spacing:1px;margin-top:10px}
</style>
</head>
<body>
<div class="header">
  <div class="title">å¤§è™Ÿè²¡ç¥çˆº</div>
  <div class="subtitle">ğŸ’© &nbsp;æŠŠå¦‚å»æ™‚é–“è®Šæˆè²¡å¯Œ &nbsp;ğŸ’©</div>
</div>
<div class="container">
  <div class="card">
    <div class="card-title">ğŸ’¼ è–ªæ°´è¨­å®š</div>
    <div class="toggle-group">
      <button class="toggle-btn active" onclick="setMode('fulltime')">ğŸ¢ å…¨è·</button>
      <button class="toggle-btn" onclick="setMode('parttime')">â° å…¼è·</button>
    </div>
    <div id="fulltime-inputs" class="input-group">
      <div class="input-row">
        <div class="input-wrap">
          <label>æœˆè–ªï¼ˆæ–°å°å¹£ï¼‰</label>
          <input type="number" id="monthly-salary" placeholder="ä¾‹ï¼š40000" oninput="calcHourly()">
        </div>
        <div class="input-wrap">
          <label>ç•¶æœˆå·¥ä½œå¤©æ•¸</label>
          <input type="number" id="work-days" placeholder="ä¾‹ï¼š22" oninput="calcHourly()">
          <div class="input-hint">ğŸ’¡ <a onclick="autoFillWorkdays()">è‡ªå‹•æ’é™¤é€±å…­æ—¥</a></div>
        </div>
      </div>
      <div class="input-row">
        <div class="input-wrap">
          <label>æ¯å¤©å·¥ä½œæ™‚æ•¸</label>
          <input type="number" id="work-hours-per-day" value="8" oninput="calcHourly()">
        </div>
      </div>
      <div class="hourly-display" id="hourly-display">æ›ç®—æ™‚è–ªï¼š<span id="hourly-rate-display">--</span> å…ƒï¼å°æ™‚</div>
    </div>
    <div id="parttime-inputs" class="input-group" style="display:none">
      <div class="input-row">
        <div class="input-wrap">
          <label>æ™‚è–ªï¼ˆæ–°å°å¹£ï¼‰</label>
          <input type="number" id="hourly-rate-pt" value="196" oninput="updateSummary();saveToStorage()">
          <div class="input-hint">2026 å¹´æœ€ä½æ™‚è–ªç‚º 196 å…ƒ</div>
        </div>
        <div class="input-wrap">
          <label>ç•¶æœˆç¸½å·¥æ™‚ï¼ˆå°æ™‚ï¼‰</label>
          <input type="number" id="total-hours-pt" placeholder="ä¾‹ï¼š80" oninput="updateSummary();saveToStorage()">
        </div>
      </div>
    </div>
    <div class="salary-warning" id="salary-warning">âš ï¸ è«‹å…ˆå¡«å¯«è–ªæ°´è¨­å®šï¼Œæ‰èƒ½è¨ˆç®—æ¯æ¬¡å¦‚å»çš„è–ªæ°´å–”ï¼</div>
  </div>

  <div class="card">
    <div class="card-title">ğŸ“… å¦‚å»ç´€éŒ„</div>
    <div class="month-nav">
      <button onclick="changeMonth(-1)">â€¹</button>
      <div class="month-label" id="month-label"></div>
      <button onclick="changeMonth(1)">â€º</button>
    </div>
    <div class="calendar-grid" id="calendar"></div>
    <div style="margin-top:12px;font-size:12px;color:var(--text-muted);text-align:center">é»æ“Šæ—¥æœŸè¨˜éŒ„å¦‚å»æ™‚é–“ &nbsp;Â·&nbsp; æ©˜è‰²èƒŒæ™¯ç‚ºé€±æœ« &nbsp;Â·&nbsp; æŒ‰ Enter å¿«é€Ÿå„²å­˜</div>
  </div>

  <div class="card">
    <div class="card-title">ğŸ“Š æœ¬æœˆæˆå°±</div>
    <div class="summary-grid">
      <div class="stat-box"><div class="stat-label">ğŸ• ç´¯ç©å¦‚å»æ™‚é–“</div><div class="stat-value" id="total-mins-display">0</div><div class="stat-sub">åˆ†é˜</div></div>
      <div class="stat-box"><div class="stat-label">â±ï¸ æ›ç®—æˆå°æ™‚</div><div class="stat-value" id="total-hours-display">0.0</div><div class="stat-sub">å°æ™‚</div></div>
      <div class="stat-box"><div class="stat-label">ğŸ’° å¸¶è–ªæ‹‰å±è³ºåˆ°</div><div class="stat-value" id="total-earned-display">0</div><div class="stat-sub">æ–°å°å¹£</div></div>
      <div class="stat-box"><div class="stat-label">ğŸ“… å·²è¨˜éŒ„å¤©æ•¸</div><div class="stat-value" id="recorded-days-display">0</div><div class="stat-sub">å¤©</div></div>
    </div>
    <div class="productivity-bar">
      <div class="prod-label"><span>å¦‚å»æ™‚é–“ä½”å·¥æ™‚æ¯”ä¾‹</span><span id="pct-label">0%</span></div>
      <div class="bar-track"><div class="bar-fill" id="bar-fill"></div></div>
    </div>
    <div class="fun-message" id="fun-message">ğŸ’¡ é–‹å§‹è¨˜éŒ„ä½ çš„å¸¶è–ªå¦‚å»æ™‚å…‰å§ï¼</div>
    <div class="footer-note" style="margin-top:16px">ğŸ’© ç§‘å­¸ç ”ç©¶è­‰å¯¦ï¼šå¥åº·äººæ¯å¤©å¦‚å» 5â€“15 åˆ†é˜ï¼Œæ‹¿è–ªæ°´æ˜¯æ‡‰å¾—çš„ ğŸ’©</div>
  </div>

  <div class="card">
    <div class="card-title">ğŸ… æˆå°±å¾½ç« </div>
    <div class="achievements-grid" id="achievements-grid"></div>
  </div>

</div>

<div class="modal-overlay" id="modal" onclick="closeModalOutside(event)">
  <div class="modal">
    <div class="modal-title">ğŸ’© è¨˜éŒ„å¦‚å»æ™‚é–“</div>
    <div class="modal-date" id="modal-date-label"></div>
    <label>ä»Šå¤©åœ¨å»æ‰€å¾…äº†å¤šä¹…ï¼Ÿ</label>
    <div class="modal-input-wrap">
      <input type="number" id="modal-mins-input" placeholder="0" min="0" max="480">
      <span class="modal-unit">åˆ†é˜</span>
    </div>
    <div class="modal-enter-hint">æŒ‰ Enter å¿«é€Ÿå„²å­˜ â†µ</div>
    <div id="modal-earned" style="margin-top:10px;font-size:13px;color:var(--accent);display:none"></div>
    <div class="modal-btns">
      <button class="btn btn-ghost" onclick="closeModal()">å–æ¶ˆ</button>
      <button class="btn btn-danger" id="btn-clear" onclick="clearDay()" style="display:none">ğŸ—‘ï¸ æ¸…é™¤</button>
      <button class="btn btn-primary" onclick="saveDay()">å„²å­˜ ğŸ’¾</button>
    </div>
  </div>
</div>
<div class="toast" id="toast"></div>

<script>
let mode='fulltime',currentYear,currentMonth,poopData={},selectedDate=null,unlockedAchievements=new Set(),newlyUnlocked=new Set();
const now=new Date();currentYear=now.getFullYear();currentMonth=now.getMonth();

// â”€â”€ localStorage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LS_DATA='dajcai_poop';
const LS_SETTINGS='dajcai_settings';

function saveToStorage(){
  try{
    localStorage.setItem(LS_DATA,JSON.stringify(poopData));
    localStorage.setItem(LS_SETTINGS,JSON.stringify({
      mode,
      salary:document.getElementById('monthly-salary').value,
      workDays:document.getElementById('work-days').value,
      workHrs:document.getElementById('work-hours-per-day').value,
      hourlyPt:document.getElementById('hourly-rate-pt').value,
      totalHrsPt:document.getElementById('total-hours-pt').value,
    }));
  }catch(e){}
}

function loadFromStorage(){
  try{
    const d=localStorage.getItem(LS_DATA);
    if(d) poopData=JSON.parse(d);
    const s=localStorage.getItem(LS_SETTINGS);
    if(s){
      const p=JSON.parse(s);
      if(p.salary) document.getElementById('monthly-salary').value=p.salary;
      if(p.workDays) document.getElementById('work-days').value=p.workDays;
      if(p.workHrs) document.getElementById('work-hours-per-day').value=p.workHrs;
      if(p.hourlyPt) document.getElementById('hourly-rate-pt').value=p.hourlyPt;
      if(p.totalHrsPt) document.getElementById('total-hours-pt').value=p.totalHrsPt;
      if(p.mode) setMode(p.mode);
    }
  }catch(e){}
}
const WD=['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
const MN=['ä¸€æœˆ','äºŒæœˆ','ä¸‰æœˆ','å››æœˆ','äº”æœˆ','å…­æœˆ','ä¸ƒæœˆ','å…«æœˆ','ä¹æœˆ','åæœˆ','åä¸€æœˆ','åäºŒæœˆ'];
const ACH=[
  {id:'first',icon:'ğŸŒ±',name:'åˆç”Ÿä¹‹çŠ¢',desc:'ç¬¬ä¸€æ¬¡è¨˜éŒ„å¦‚å»',check:(m,d,mx,e)=>d>=1},
  {id:'day15',icon:'ğŸš½',name:'å»æ‰€å¸¸é§',desc:'å–®æ—¥å¦‚å» 15 åˆ†é˜ä»¥ä¸Š',check:(m,d,mx,e)=>mx>=15},
  {id:'day30',icon:'ğŸ¤¢',name:'è…¸èƒƒåœ¨æŠ—è­°',desc:'å–®æ—¥å¦‚å» 30 åˆ†é˜ä»¥ä¸Š',check:(m,d,mx,e)=>mx>=30},
  {id:'hr1',icon:'ğŸ’ª',name:'å»æ‰€è¾¦å…¬å®¤',desc:'ç´¯ç©å¦‚å» 1 å°æ™‚',check:(m,d,mx,e)=>m>=60},
  {id:'hr8',icon:'ğŸ˜´',name:'å…¨è·æ‹‰å±å“¡',desc:'ç´¯ç©å¦‚å» 8 å°æ™‚',check:(m,d,mx,e)=>m>=480},
  {id:'hr40',icon:'ğŸ†',name:'æ‹‰å±å‚³èªª',desc:'ç´¯ç©å¦‚å» 40 å°æ™‚',check:(m,d,mx,e)=>m>=2400},
  {id:'earn100',icon:'ğŸ“',name:'è²¡ç¥çˆºç‰¹é¸',desc:'æœ¬æœˆå¦‚å»è³ºè¶…é 100 å…ƒ',check:(m,d,mx,e)=>e>=100},
  {id:'earn1000',icon:'ğŸ’©',name:'å¸¶è–ªæ‹‰å±ä¹‹ç¥',desc:'æœ¬æœˆå¦‚å»è³ºè¶…é 1000 å…ƒ',check:(m,d,mx,e)=>e>=1000},
];

function setMode(m){mode=m;document.querySelectorAll('.toggle-btn').forEach((b,i)=>b.classList.toggle('active',(i===0&&m==='fulltime')||(i===1&&m==='parttime')));document.getElementById('fulltime-inputs').style.display=m==='fulltime'?'block':'none';document.getElementById('parttime-inputs').style.display=m==='parttime'?'block':'none';updateSummary();saveToStorage()}

function getHourlyRate(){if(mode==='fulltime'){const s=parseFloat(document.getElementById('monthly-salary').value)||0,d=parseFloat(document.getElementById('work-days').value)||0,h=parseFloat(document.getElementById('work-hours-per-day').value)||8;return(s>0&&d>0&&h>0)?s/(d*h):0}return parseFloat(document.getElementById('hourly-rate-pt').value)||0}

function getTotalWorkMinutes(){if(mode==='fulltime'){const d=parseFloat(document.getElementById('work-days').value)||0,h=parseFloat(document.getElementById('work-hours-per-day').value)||8;return d*h*60}return(parseFloat(document.getElementById('total-hours-pt').value)||0)*60}

function calcHourly(){const r=getHourlyRate();const el=document.getElementById('hourly-display');if(r>0){el.style.display='block';document.getElementById('hourly-rate-display').textContent=r.toFixed(1)}else el.style.display='none';updateSummary();saveToStorage()}

function autoFillWorkdays(){const dim=new Date(currentYear,currentMonth+1,0).getDate();let c=0;for(let d=1;d<=dim;d++){const dw=new Date(currentYear,currentMonth,d).getDay();if(dw!==0&&dw!==6)c++}document.getElementById('work-days').value=c;calcHourly();showToast('ğŸ“… '+MN[currentMonth]+'å…±æœ‰ '+c+' å€‹å·¥ä½œå¤©')}

function changeMonth(delta){currentMonth+=delta;if(currentMonth>11){currentMonth=0;currentYear++}if(currentMonth<0){currentMonth=11;currentYear--}renderCalendar();updateSummary()}

function renderCalendar(){
  document.getElementById('month-label').textContent=currentYear+' å¹´ '+MN[currentMonth];
  const grid=document.getElementById('calendar');grid.innerHTML='';
  WD.forEach((d,i)=>{const h=document.createElement('div');h.className='cal-header'+(i===0||i===6?' wh':'');h.textContent=d;grid.appendChild(h)});
  const fd=new Date(currentYear,currentMonth,1).getDay();
  const dim=new Date(currentYear,currentMonth+1,0).getDate();
  const today=new Date();
  for(let i=0;i<fd;i++){const e=document.createElement('div');e.className='cal-day empty';grid.appendChild(e)}
  for(let d=1;d<=dim;d++){
    const key=dk(currentYear,currentMonth,d);
    const dow=new Date(currentYear,currentMonth,d).getDay();
    const isToday=today.getFullYear()===currentYear&&today.getMonth()===currentMonth&&today.getDate()===d;
    const isWE=dow===0||dow===6;
    const hasData=poopData[key]>0;
    const el=document.createElement('div');
    el.className='cal-day'+(hasData?' has-data':'')+(isToday?' today':'')+(isWE?' we':'');
    const nd=document.createElement('div');nd.className='cal-day-num';nd.textContent=d;el.appendChild(nd);
    if(hasData){const em=document.createElement('div');em.className='cal-day-emoji';em.textContent='ğŸ’©';el.appendChild(em);const md=document.createElement('div');md.className='cal-day-mins';md.textContent=poopData[key]+'åˆ†';el.appendChild(md)}
    el.addEventListener('click',()=>openModal(currentYear,currentMonth,d));
    grid.appendChild(el);
  }
}

function dk(y,m,d){return y+'-'+String(m+1).padStart(2,'0')+'-'+String(d).padStart(2,'0')}

function openModal(y,m,d){
  const r=getHourlyRate();const w=document.getElementById('salary-warning');
  if(r===0){w.style.display='block';w.scrollIntoView({behavior:'smooth',block:'center'});setTimeout(()=>w.style.display='none',3000);return}
  w.style.display='none';
  selectedDate=dk(y,m,d);
  document.getElementById('modal-date-label').textContent=y+' å¹´ '+(m+1)+' æœˆ '+d+' æ—¥ï¼ˆæ˜ŸæœŸ'+WD[new Date(y,m,d).getDay()]+'ï¼‰';
  const inp=document.getElementById('modal-mins-input');
  const has=poopData[selectedDate]>0;
  inp.value=has?poopData[selectedDate]:'';
  document.getElementById('btn-clear').style.display=has?'flex':'none';
  updateModalEarned(inp.value);
  inp.oninput=()=>updateModalEarned(inp.value);
  document.getElementById('modal').classList.add('open');
  setTimeout(()=>inp.focus(),200);
}

function updateModalEarned(v){const m=parseFloat(v)||0;const r=getHourlyRate();const el=document.getElementById('modal-earned');if(r>0&&m>0){el.style.display='block';el.textContent='ğŸ’° é€™ '+m+' åˆ†é˜è³ºäº†ä½  '+(m/60*r).toFixed(1)+' å…ƒï¼'}else el.style.display='none'}

function closeModal(){document.getElementById('modal').classList.remove('open');selectedDate=null}
function closeModalOutside(e){if(e.target===document.getElementById('modal'))closeModal()}

function clearDay(){if(selectedDate)delete poopData[selectedDate];closeModal();renderCalendar();updateSummary();saveToStorage();showToast('ğŸ—‘ï¸ å·²æ¸…é™¤ç´€éŒ„')}

function saveDay(){const m=parseFloat(document.getElementById('modal-mins-input').value)||0;if(selectedDate){if(m>0)poopData[selectedDate]=m;else delete poopData[selectedDate]}closeModal();renderCalendar();updateSummary();saveToStorage()}

document.getElementById('modal-mins-input').addEventListener('keydown',e=>{if(e.key==='Enter')saveDay();if(e.key==='Escape')closeModal()});

function updateSummary(){
  const pre=currentYear+'-'+String(currentMonth+1).padStart(2,'0')+'-';
  let totalMins=0,recordedDays=0,maxDay=0;
  Object.keys(poopData).forEach(k=>{if(k.startsWith(pre)&&poopData[k]>0){totalMins+=poopData[k];recordedDays++;if(poopData[k]>maxDay)maxDay=poopData[k]}});
  const r=getHourlyRate(),earned=totalMins/60*r,twm=getTotalWorkMinutes();
  const pct=twm>0?Math.min(totalMins/twm*100,100):0;
  document.getElementById('total-mins-display').textContent=totalMins;
  document.getElementById('total-hours-display').textContent=(totalMins/60).toFixed(1);
  document.getElementById('total-earned-display').textContent=earned>0?Math.round(earned):0;
  document.getElementById('recorded-days-display').textContent=recordedDays;
  document.getElementById('pct-label').textContent=pct.toFixed(1)+'%';
  document.getElementById('bar-fill').style.width=pct+'%';
  const msgs=[{min:0,msg:'ğŸ’¡ é–‹å§‹è¨˜éŒ„ä½ çš„å¸¶è–ªå¦‚å»æ™‚å…‰å§ï¼'},{min:1,msg:'ğŸŒ± äººç”Ÿç¬¬ä¸€æ³¡ï¼Œå‰é€”ç„¡é‡ï¼'},{min:30,msg:'âœ¨ é‚„ä¸éŒ¯å˜›ï¼Œç¹¼çºŒåŠ æ²¹ï¼'},{min:60,msg:'ğŸ’ª ä¸€å°æ™‚ï¼å»æ‰€å°±æ˜¯ä½ çš„è¾¦å…¬å®¤ï¼'},{min:120,msg:'ğŸ”¥ å…©å°æ™‚ï¼ä½ æ˜¯çœŸæ­£çš„å¸¶è–ªæ‹‰å±é”äººï¼'},{min:300,msg:'ğŸ‘‘ äº”å°æ™‚ï¼è€é—†åœ¨ç‚ºä½ çš„è…¸èƒƒä»˜è–ªæ°´ï¼'},{min:600,msg:'ğŸ† ä½ æ˜¯å‚³èªªï¼å»æ‰€æ‡‰è©²çµ¦ä½ ç™¼å¹´çµ‚ï¼'}];
  let msg=msgs[0].msg;for(const m of msgs){if(totalMins>=m.min)msg=m.msg}
  document.getElementById('fun-message').textContent=msg;
  checkAchievements(totalMins,recordedDays,maxDay,earned);
  calcHourly();
}

function checkAchievements(tm,rd,mx,e){
  newlyUnlocked.clear();
  ACH.forEach(a=>{const was=unlockedAchievements.has(a.id);if(a.check(tm,rd,mx,e)){if(!was)newlyUnlocked.add(a.id);unlockedAchievements.add(a.id)}});
  newlyUnlocked.forEach(id=>{const a=ACH.find(x=>x.id===id);if(a)showToast('ğŸ… æˆå°±è§£é–ï¼š'+a.icon+' '+a.name+'ï¼')});
  renderAchievements();
}

function renderAchievements(){
  const grid=document.getElementById('achievements-grid');grid.innerHTML='';
  ACH.forEach(a=>{
    const u=unlockedAchievements.has(a.id),n=newlyUnlocked.has(a.id);
    const el=document.createElement('div');el.className='achievement '+(u?'unlocked':'locked');
    el.innerHTML=(n?'<span class="badge-new">NEW</span>':'')+'<span class="achievement-icon">'+a.icon+'</span><div class="achievement-name">'+a.name+'</div><div class="achievement-desc">'+a.desc+'</div>';
    grid.appendChild(el);
  });
}

let toastTimer;
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');clearTimeout(toastTimer);toastTimer=setTimeout(()=>t.classList.remove('show'),2800)}

renderCalendar();renderAchievements();loadFromStorage();renderCalendar();updateSummary();
</script>
</body>
</html>
